(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[407],{73339:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var a=n(11527),r=n(27149),s=n(34310),c=n(13105);n(50959);var o=n(71192),i=n.n(o);function l(){return(0,a.jsxs)("div",{className:i().footer,children:[(0,a.jsxs)("p",{children:["Code and data are ",(0,a.jsx)(r.Z,{href:s.Tf.href,children:"on GitHub"}),". ",(0,a.jsx)(r.Z,{href:"".concat(s.Tf.href,"/issues/new"),children:"File an issue"}),", ",(0,a.jsx)("a",{href:"mailto:".concat(s.fQ),children:"send us an email"}),", or ",(0,a.jsx)(r.Z,{href:"https://hudcostreets.org/get-involved",children:"get involved"}),"."]}),(0,a.jsx)(c.I_,{socials:[{name:"Hudson County Complete Streets",title:"Hudson County Complete Streets",href:"https://hudcostreets.org",src:"/logos/hccs.png"}]})]})}},17618:function(e,t,n){"use strict";n.d(t,{HQ:function(){return r},Of:function(){return a}});let a="".concat("hudcostreets","/").concat("nj-crashes"),r="https://github.com/".concat(a)},99701:function(e,t,n){"use strict";n.d(t,{f:function(){return x},eF:function(){return D},l_:function(){return P}});var a=n(11527),r=n(50959),s=n(26725),c=n(14445),o=n(78912).Buffer;async function i(e){let{db:t,table:n,csvText:a}=e;return await t.registerFileText(n,a),t}async function l(e){let t,{db:n,tableData:a,stem:r}=e;if("csv"===a.kind){let e="".concat(r,".csv");t="'".concat(e,"'"),await n.registerFileText(e,a.data)}else{let e="".concat(r,".parquet");t="parquet_scan('".concat(e,"')");let s=new Uint8Array(o.from(a.base64,"base64"));await n.registerFileBuffer(e,s)}return t}var u=n(4555),d=n(56479),h=n.n(d);let f="/njsp/projected.csv",p=(0,s.basename)(f),m=e=>"\n    SELECT\n        CAST(sum(driver) as INT) as driver,\n        CAST(sum(pedestrian) as INT) as pedestrian,\n        CAST(sum(cyclist) as INT) as cyclist,\n        CAST(sum(passenger) as INT) as passenger\n    FROM ".concat(p,"\n    ").concat(e?"WHERE county = '".concat(e,"'"):"","\n"),y=e=>{let{county:t,target:n}=e;return"\n    SELECT\n        year,\n        CAST(sum(driver) as INT) as driver,\n        CAST(sum(pedestrian) as INT) as pedestrian,\n        CAST(sum(cyclist) as INT) as cyclist,\n        CAST(sum(passenger) as INT) as passenger,\n        CAST(sum(driver + pedestrian + cyclist + passenger) as INT) as total,\n        NULL as projected\n    FROM ".concat(n,"\n    ").concat(t?"WHERE county = '".concat(t,"'"):"","\n    GROUP BY year\n")};var g=n(17618),j=n(27149),S=n(34310),b=n(13910),w=n(23007),v=n(41796);async function N(e){let{ytRows:t,typeProjections:n,initialPlotData:a,types:r,county:s}=e,c=Array.from(r),o={Drivers:"driver",Pedestrians:"pedestrian",Cyclists:"cyclist",Passengers:"passenger",Projected:"projected"};console.log("typeProjections:",n);let i=c.map(e=>{let t=o[e];return t in n?n[t]:0}).reduce((e,t)=>e+t,0);console.log("ytRows:",t);let l={...t[t.length-1]},d=[...t.slice(0,t.length-1),l];if(l.year==u.$B){let e=c.map(e=>l[o[e]]).reduce((e,t)=>e+t,0);l.projected=i-e}else console.warn("getPlotData: last year is not ".concat(u.$B,":"),l," (county: ".concat(s,")")),d.push({year:u.$B,driver:0,pedestrian:0,cyclist:0,passenger:0,total:0,projected:i});console.log("got ytc data:",d);let h=1===r.size,f=a.map(e=>{let{name:t}=e,n=o[t],a={...e};return a.x=d.map(e=>e.year),a.y=d.map(e=>e[n]),a.visible=!!r.has(t)||"legendonly",h||(a.textposition="inside"),a}),p=h?[]:d.map(e=>{let{year:t,projected:n}=e,a=c.map(t=>e[o[t]]).reduce((e,t)=>e+t,0);return{x:t,y:a,text:"".concat(a),showarrow:!1,yshift:10}}),m=(0,w.sq)(d.map(e=>{let{year:t,total:n,projected:a}=e;return[t,{total:n,projected:a}]}));return{rows:d,data:f,annotations:p,yearTotalsMap:m}}let x="Car Crash Deaths",T=["Drivers","Pedestrians","Cyclists","Passengers","Projected"],C=(e,t)=>{let n=document.createElement("span");document.body.appendChild(n),n.style.font=t,n.style.position="absolute",n.style.height="auto",n.style.width="auto",n.style.whiteSpace="nowrap",n.textContent=e;let a=Math.ceil(n.getBoundingClientRect().width);return document.body.removeChild(n),a};function _(e){let{region:t,setRegion:n,counties:s}=e,c=(0,r.useRef)(null);return(0,r.useEffect)(()=>{if(c.current){let{fontSize:e,fontWeight:n,fontFamily:a}=window.getComputedStyle(c.current),r="".concat(n," ").concat(e," ").concat(a),s=C("NJ"===t?"NJ":"".concat(t," County"),r);c.current.style.width="".concat(s+30,"px")}},[t]),(0,a.jsxs)("select",{className:h().countySelect,ref:c,value:t,onChange:e=>{n(e.target.value)},children:[(0,a.jsx)("option",{value:"NJ",children:"NJ"}),s.map(e=>(0,a.jsxs)("option",{value:e,children:[e," County"]},e))]})}let J="https://nbviewer.org/github/".concat(g.Of,"/blob/main/njsp/update-projections.ipynb");function D(e){let{rundate:t,yearTotalsMap:n,includeWorstYearsBlurb:r}=e,s=n["2021"].total,c=n["2022"].total,o=n[u.Vz].total,i=n[u.$B];if(!i)return console.warn("NjspChildren: yearTotalsMap doesn't contain ".concat(u.$B,":"),n),null;let{total:l,projected:d}=i,h=l+d,f=new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",timeZone:"UTC"});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{children:"Click/Double-click the legend labels to toggle or solo each type."}),(0,a.jsxs)("p",{children:[(0,a.jsxs)(j.Z,{href:"".concat(S.Tf.href,"/commits/main"),children:["As of ",f]}),", ",u.$B," has ",l," reported deaths, and ",(0,a.jsx)(j.Z,{href:J,children:"is on pace"})," for ",h,h>o?", exceeding ".concat(u.Vz,"'s ").concat(o):"","."]}),(0,a.jsxs)("p",{children:["Data comes from ",(0,a.jsx)(j.Z,{title:"NJ State Police fatal crash data",href:v.jy,children:"NJ State Police"}),", and is updated daily (though crashes sometimes take weeks or months to show up)."]}),!1!==r&&(0,a.jsxs)("p",{children:["2021 and 2022 were the worst years in the NJSP record (since 2008), with ",s," and ",c," deaths, resp."]})]})}function P(e){let{params:t,tableData:n,typeProjections:o,counties:d,ytRows:h,rundate:g,yearTotalsMap:j,county:S,title:w,subtitle:v,heading:C,Heading:J="h2",spec:P,setCounty:E}=e,{src:k,name:B}=P=null!=P?P:u.xW;k=null!=k?k:"plots/".concat(B,".png");let[A,I]=(0,r.useState)(new Set(T)),F=(0,c.W_)(),{data:M,layout:R,...Z}=t,[H,Y]=(0,r.useState)(M),[L,O]=(0,r.useState)(R.annotations),[V]=function(e){let{url:t,db:n,table:a,query:o,init:l}=e,u=function(e){let{db:t,table:n,url:a}=e,[s,c]=(0,r.useState)(null),o=function(e){let{url:t}=e,[n,a]=(0,r.useState)(null);return(0,r.useEffect)(()=>{fetch(t).then(e=>e.text()).then(a)},[t]),n}({url:a});return(0,r.useEffect)(()=>{(async function(){t&&o&&(console.log("registering db table ".concat(n,": ").concat(a)),c(await i({db:t,table:n,csvText:o})))})()},[t,o]),s}({db:n,table:null!=a?a:(0,s.basename)(t),url:t}),[d,h]=(0,r.useState)(l);return(0,r.useEffect)(()=>{(async function(){console.log("querying table ".concat(a)),u&&h(await (0,c.Vn)(u,o))})()},[u,o]),d}({url:f,db:F,table:p,query:m(S),init:[o]}),[$,q]=(0,r.useState)(j),z=(0,r.useCallback)(e=>{if(A.has(e)){console.log("types: disable ".concat(e));let t=new Set(Array.from(A));t.delete(e),I(t)}else{console.log("types: enable ".concat(e));let t=new Set(Array.from(A));t.add(e),I(t)}return!1},[A]),U=(0,r.useCallback)(e=>(A.size<=1?(console.log("types: remove solo ".concat(e)),I(new Set(T))):(console.log("types: solo ".concat(e)),I(new Set([e]))),!1),[A]),W=function(e){let{db:t,tableData:n,stem:a}=e,[s,c]=(0,r.useState)(null);return(0,r.useEffect)(()=>{(async function(){if(!t)return;console.log("got db:",t);let e=await l({db:t,tableData:n,stem:a});console.log("registered target:",e),c(e)})()},[t,n]),s}({db:F,tableData:n,stem:"ytc"}),[Q,G]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(!F||!W)return;let e=y({county:null!=S?S:null,target:W});console.log("updating ytQuery:",e),G(e)},[F,W,S]);let X=(0,c.aM)({db:F,query:Q,init:h});return(0,r.useEffect)(()=>{(async function(){if(!F||!W)return;let{data:e,annotations:t,yearTotalsMap:n}=await N({ytRows:X,typeProjections:V,initialPlotData:M,types:A,county:S});Y(e),O(t),q(n)})()},[F,W,X,V,M,A,S]),w=null!=w?w:x,(0,a.jsx)(b.XN,{...P,params:{data:H,layout:{...R,annotations:L,margin:{t:0,r:10,b:0,l:0}},...Z},src:k,title:w,subtitle:v,heading:null!=C?C:E?(0,a.jsxs)(J,{children:[w,":",(0,a.jsx)(_,{region:null!=S?S:"NJ",setRegion:e=>E("NJ"===e?null:e),counties:d})]}):null,onLegendClick:z,onLegendDoubleClick:U,children:(0,a.jsx)(D,{rundate:g,yearTotalsMap:$,includeWorstYearsBlurb:null===S})})}},4555:function(e,t,n){"use strict";n.d(t,{$B:function(){return c},Vv:function(){return d},Vz:function(){return o},xW:function(){return u}});var a=n(11527);n(50959);var r=n(13910),s=n(27149);let c=new Date().getFullYear(),o=c-1,i=[],l=i.concat(...["y","m"].map(e=>i.concat(...["s","c"].map(t=>i.concat(...["d","i","p"].map(n=>{let a="".concat(n).concat(t).concat(e),r={s:"State",c:"County"}[t],s={y:"Year",m:"Month"}[e],c="".concat({s:"State",c:"Counties"}[t]," x ").concat(s,"s"),o={i:"Traffic Crash Injuries",p:"Property Damage Crashes",d:"Traffic Deaths"}[n],i="State"==r?"NJ ".concat(o," per ").concat(s):"NJ ".concat(o," per {").concat(r,", ").concat(s,"}");return"dcm"==a&&(i+=" (12mo avgs)"),{id:a,name:"njdot/".concat(a),title:i,menuName:({i:"Injuries",p:"Property Damage",d:"Deaths"})[n],dropdownSection:c,style:"County"==r&&{height:580}}})))))),u={title:"NJ Traffic Deaths per Year",id:"per-year",name:"fatalities_per_year_by_type",menuName:"Traffic Deaths / Year",dropdownSection:"NJSP",filter:(0,r.m_)({mapRange:r.Oj})},d=[u,{id:"ytd",name:"ytd-deaths",title:"NJ Traffic Deaths per Year",menuName:"YTD",dropdownSection:"NJSP",filter:r._c,children:(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("p",{children:"Some data arrives weeks or months after the fact, so current year numbers are especially subject to change."})})},{id:"vs-homicides",name:"crash_homicide_cmp",title:"NJ Traffic Deaths vs. Homicides",menuName:"vs. Homicides",dropdownSection:"NJSP",children:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{children:"Traffic crashes kill 1.5-2x as many people as homicides in NJ."}),(0,a.jsxs)("p",{children:["Homicide data comes from ",(0,a.jsx)(s.Z,{href:"https://nj.gov/njsp/ucr/uniform-crime-reports.shtml",children:"NJ State Police"})," and ",(0,a.jsx)(s.Z,{href:"https://www.disastercenter.com/crime/njcrimn.htm",children:"Disaster Center"}),"."]})]})},{id:"per-month",name:"fatalities_per_month",title:"NJ Traffic Deaths per Month",menuName:"Per Month",dropdownSection:"NJSP"},{id:"per-month-type",name:"fatalities_per_month_by_type",title:"NJ Traffic Deaths per Month (by Victim Type)",menuName:"By Victim Type",dropdownSection:"NJSP"},{id:"by-month-bars",name:"fatalities_by_month_bars",title:"NJ Traffic Deaths, grouped by month",menuName:"Grouped by Month",dropdownSection:"NJSP"},...l]},34310:function(e,t,n){"use strict";n.d(t,{Tf:function(){return s},fQ:function(){return l},UY:function(){return i}});var a=n(13105);n(27842),n(32262);var r=n(17618);let s=a.Tf(r.Of,"svg"),c=a.tL("hudcostreets"),o=a.mr("hudcostreets"),i=[s,a._F("@neighborryan"),c,o],l="crash-data@hudcostreets.org"},41796:function(e,t,n){"use strict";n.d(t,{Iv:function(){return c},jy:function(){return s},mB:function(){return o}});var a=n(21358),r=n(62400);let s="https://nj.gov/njsp/info/fatalacc/",c="https://www.state.nj.us/transportation/refdata/accident/rawdata01-current.shtm";function o(){let e=r.env.S3_DBS?"https://nj-crashes.s3.amazonaws.com/njdot/data":"".concat((0,a.b)(),"/njdot");return{crashes:"".concat(e,"/crashes.db"),occupants:"".concat(e,"/occupants.db"),pedestrians:"".concat(e,"/pedestrians.db"),vehicles:"".concat(e,"/vehicles.db"),drivers:"".concat(e,"/drivers.db"),cmym:"".concat(e,"/cmym.db"),cmymc:"".concat(e,"/cmymc.db")}}},71192:function(e){e.exports={footer:"footer_footer__gb1e2"}},56479:function(e){e.exports={countySelect:"plot_countySelect__065N_"}}}]);