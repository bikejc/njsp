(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[407],{42977:function(e,t,n){"use strict";n.d(t,{RY:function(){return u},mY:function(){return o}});var a=n(11527),r=n(50959),c=n(40873),s=n.n(c);let o=(e,t)=>{let n=document.createElement("span");document.body.appendChild(n),n.style.font=t,n.style.position="absolute",n.style.height="auto",n.style.width="auto",n.style.whiteSpace="nowrap",n.textContent=e;let a=Math.ceil(n.getBoundingClientRect().width);return document.body.removeChild(n),a},i=e=>e?"".concat(e," County"):"NJ",l=e=>e||"NJ";function u(e){let{county:t,setCounty:n,Counties:c}=e,u=(0,r.useMemo)(()=>l(t),[t]),d=(0,r.useRef)(null);return(0,r.useEffect)(()=>{if(d.current){let{fontSize:e,fontWeight:n,fontFamily:a}=window.getComputedStyle(d.current),r="".concat(n," ").concat(e," ").concat(a),c=o(i(t),r);d.current.style.width="".concat(c+30,"px")}},[t]),(0,a.jsxs)("select",{className:s().countySelect,ref:d,value:u,onChange:e=>{let t=e.target.value;n("NJ"===t?null:t)},children:[(0,a.jsx)("option",{value:"NJ",children:"NJ"}),c.map(e=>(0,a.jsx)("option",{value:e,children:i(e)},e))]})}},19622:function(e,t,n){"use strict";n.d(t,{F:function(){return r},c:function(){return c}});var a=n(45112);let r=e=>e.toLowerCase().replaceAll(" ","-"),c=e=>(0,a.Q)(e.replaceAll("-"," "))},73339:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var a=n(11527),r=n(27149),c=n(34310),s=n(13105);n(50959);var o=n(71192),i=n.n(o);function l(){return(0,a.jsxs)("div",{className:i().footer,children:[(0,a.jsxs)("p",{children:["Code and data are ",(0,a.jsx)(r.Z,{href:c.Tf.href,children:"on GitHub"}),". ",(0,a.jsx)(r.Z,{href:"".concat(c.Tf.href,"/issues/new"),children:"File an issue"}),", ",(0,a.jsx)("a",{href:"mailto:".concat(c.fQ),children:"send us an email"}),", or ",(0,a.jsx)(r.Z,{href:"https://hudcostreets.org/get-involved",children:"get involved"}),"."]}),(0,a.jsx)(s.I_,{socials:[{name:"Hudson County Complete Streets",title:"Hudson County Complete Streets",href:"https://hudcostreets.org",src:"/logos/hccs.png"}]})]})}},17618:function(e,t,n){"use strict";n.d(t,{HQ:function(){return r},Of:function(){return a}});let a="".concat("hudcostreets","/").concat("nj-crashes"),r="https://github.com/".concat(a)},99701:function(e,t,n){"use strict";n.d(t,{f:function(){return C},l_:function(){return D}});var a=n(11527),r=n(50959),c=n(26725),s=n(14445),o=n(78912).Buffer;async function i(e){let{db:t,table:n,csvText:a}=e;return await t.registerFileText(n,a),t}async function l(e){let t,{db:n,tableData:a,stem:r}=e;if("csv"===a.kind){let e="".concat(r,".csv");t="'".concat(e,"'"),await n.registerFileText(e,a.data)}else{let e="".concat(r,".parquet");t="parquet_scan('".concat(e,"')");let c=new Uint8Array(o.from(a.base64,"base64"));await n.registerFileBuffer(e,c)}return t}var u=n(4555);let d="/njsp/projected.csv",h=(0,c.basename)(d),f=e=>"\n    SELECT\n        CAST(sum(driver) as INT) as driver,\n        CAST(sum(pedestrian) as INT) as pedestrian,\n        CAST(sum(cyclist) as INT) as cyclist,\n        CAST(sum(passenger) as INT) as passenger\n    FROM ".concat(h,"\n    ").concat(e?"WHERE county = '".concat(e,"'"):"","\n"),p=e=>{let{county:t,target:n}=e;return"\n    SELECT\n        year,\n        CAST(sum(driver) as INT) as driver,\n        CAST(sum(pedestrian) as INT) as pedestrian,\n        CAST(sum(cyclist) as INT) as cyclist,\n        CAST(sum(passenger) as INT) as passenger,\n        CAST(sum(driver + pedestrian + cyclist + passenger) as INT) as total,\n        NULL as projected\n    FROM ".concat(n,"\n    ").concat(t?"WHERE county = '".concat(t,"'"):"","\n    GROUP BY year\n")};var m=n(17618),y=n(27149),g=n(34310),j=n(13910),w=n(23007),S=n(41796),v=n(19622),b=n(42977);async function x(e){let{ytRows:t,typeProjections:n,initialPlotData:a,types:r,county:c}=e,s=Array.from(r),o={Drivers:"driver",Pedestrians:"pedestrian",Cyclists:"cyclist",Passengers:"passenger",Projected:"projected"};console.log("typeProjections:",n);let i=s.map(e=>{let t=o[e];return t in n?n[t]:0}).reduce((e,t)=>e+t,0);console.log("ytRows:",t);let l={...t[t.length-1]},d=[...t.slice(0,t.length-1),l];if(l.year==u.$B){let e=s.map(e=>l[o[e]]).reduce((e,t)=>e+t,0);l.projected=i-e}else console.warn("getPlotData: last year is not ".concat(u.$B,":"),l," (county: ".concat(c,")")),d.push({year:u.$B,driver:0,pedestrian:0,cyclist:0,passenger:0,total:0,projected:i});console.log("got ytc data:",d);let h=1===r.size,f=a.map(e=>{let{name:t}=e,n=o[t],a={...e};return a.x=d.map(e=>e.year),a.y=d.map(e=>e[n]),a.visible=!!r.has(t)||"legendonly",h||(a.textposition="inside"),a}),p=h?[]:d.map(e=>{let{year:t,projected:n}=e,a=s.map(t=>e[o[t]]).reduce((e,t)=>e+t,0);return{x:t,y:a,text:"".concat(a),showarrow:!1,yshift:10}}),m=(0,w.sq)(d.map(e=>{let{year:t,total:n,projected:a}=e;return[t,{total:n,projected:a}]}));return{rows:d,data:f,annotations:p,yearTotalsMap:m}}let C="Car Crash Deaths",N=["Drivers","Pedestrians","Cyclists","Passengers","Projected"],T="https://nbviewer.org/github/".concat(m.Of,"/blob/main/njsp/update-projections.ipynb");function _(e){let{rundate:t,yearTotalsMap:n,county:r,includeMoreInfoLink:c}=e,s=n["2021"].total,o=n["2022"].total,i=n[u.Vz].total,l=n[u.$B];if(!l)return console.warn("NjspChildren: yearTotalsMap doesn't contain ".concat(u.$B,":"),n),null;let{total:d,projected:h}=l,f=d+h,p=new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",timeZone:"UTC"});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{children:"Click/Double-click the legend labels to toggle or solo each type."}),(0,a.jsxs)("p",{children:[(0,a.jsxs)(y.Z,{href:"".concat(g.Tf.href,"/commits/main"),children:["As of ",p]}),", ",u.$B," has ",d," reported deaths, and ",(0,a.jsx)(y.Z,{href:T,children:"is on pace"})," for ",f,f>i?", exceeding ".concat(u.Vz,"'s ").concat(i):"",".",c?(0,a.jsxs)(a.Fragment,{children:[" ",(0,a.jsxs)(y.Z,{href:"/c/".concat(r?(0,v.F)(r):""),children:["More ",r?"".concat(r," County"):"state-wide"," data"]}),"."]}):null]}),null===r?(0,a.jsxs)("p",{children:["2021 and 2022 were the worst years in the NJSP record (since 2008), with ",s," and ",o," deaths, resp."]}):null,(0,a.jsxs)("p",{children:["Data comes from ",(0,a.jsx)(y.Z,{title:"NJ State Police fatal crash data",href:S.jy,children:"NJ State Police"}),", and is updated daily (though crashes sometimes take weeks or months to show up)."]})]})}function D(e){let{params:t,tableData:n,typeProjections:o,Counties:m,ytRows:g,rundate:w,yearTotalsMap:S,county:v,title:T,subtitle:D,heading:J,Heading:P="h2",spec:E,setCounty:k,includeMoreInfoLink:A}=e,{src:M,name:F}=E=null!=E?E:u.xW;M=null!=M?M:"plots/".concat(F,".png");let[I,B]=(0,r.useState)(new Set(N)),R=(0,s.W_)(),{data:Z,layout:Y,...L}=t,[H,O]=(0,r.useState)(Z),[$,q]=(0,r.useState)(Y.annotations),[z]=function(e){let{url:t,db:n,table:a,query:o,init:l}=e,u=function(e){let{db:t,table:n,url:a}=e,[c,s]=(0,r.useState)(null),o=function(e){let{url:t}=e,[n,a]=(0,r.useState)(null);return(0,r.useEffect)(()=>{fetch(t).then(e=>e.text()).then(a)},[t]),n}({url:a});return(0,r.useEffect)(()=>{(async function(){t&&o&&(console.log("registering db table ".concat(n,": ").concat(a)),s(await i({db:t,table:n,csvText:o})))})()},[t,o]),c}({db:n,table:null!=a?a:(0,c.basename)(t),url:t}),[d,h]=(0,r.useState)(l);return(0,r.useEffect)(()=>{(async function(){console.log("querying table ".concat(a)),u&&h(await (0,s.Vn)(u,o))})()},[u,o]),d}({url:d,db:R,table:h,query:f(v),init:[o]}),[U,Q]=(0,r.useState)(S),V=(0,r.useCallback)(e=>{if(I.has(e)){console.log("types: disable ".concat(e));let t=new Set(Array.from(I));t.delete(e),B(t)}else{console.log("types: enable ".concat(e));let t=new Set(Array.from(I));t.add(e),B(t)}return!1},[I]),W=(0,r.useCallback)(e=>(I.size<=1?(console.log("types: remove solo ".concat(e)),B(new Set(N))):(console.log("types: solo ".concat(e)),B(new Set([e]))),!1),[I]),G=function(e){let{db:t,tableData:n,stem:a}=e,[c,s]=(0,r.useState)(null);return(0,r.useEffect)(()=>{(async function(){if(!t)return;console.log("got db:",t);let e=await l({db:t,tableData:n,stem:a});console.log("registered target:",e),s(e)})()},[t,n]),c}({db:R,tableData:n,stem:"ytc"}),[X,K]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(!R||!G)return;let e=p({county:null!=v?v:null,target:G});console.log("updating ytQuery:",e),K(e)},[R,G,v]);let ee=(0,s.aM)({db:R,query:X,init:g});return(0,r.useEffect)(()=>{(async function(){if(!R||!G)return;let{data:e,annotations:t,yearTotalsMap:n}=await x({ytRows:ee,typeProjections:z,initialPlotData:Z,types:I,county:v});O(e),q(t),Q(n)})()},[R,G,ee,z,Z,I,v]),T=null!=T?T:C,(0,a.jsx)(j.XN,{...E,params:{data:H,layout:{...Y,annotations:$,margin:{t:0,r:10,b:0,l:0}},...L},src:M,title:T,subtitle:D,heading:null!=J?J:k?(0,a.jsxs)(P,{children:[(0,a.jsx)(y.Z,{href:"#".concat(E.id),children:T}),":",(0,a.jsx)(b.RY,{county:v,setCounty:k,Counties:m})]}):null,onLegendClick:V,onLegendDoubleClick:W,children:(0,a.jsx)(_,{rundate:w,yearTotalsMap:U,county:v,includeMoreInfoLink:A})})}},4555:function(e,t,n){"use strict";n.d(t,{$B:function(){return s},Vv:function(){return d},Vz:function(){return o},xW:function(){return u}});var a=n(11527);n(50959);var r=n(13910),c=n(27149);let s=new Date().getFullYear(),o=s-1,i=[],l=i.concat(...["y","m"].map(e=>i.concat(...["s","c"].map(t=>i.concat(...["d","i","p"].map(n=>{let a="".concat(n).concat(t).concat(e),r={s:"State",c:"County"}[t],c={y:"Year",m:"Month"}[e],s="".concat({s:"State",c:"Counties"}[t]," x ").concat(c,"s"),o={i:"Traffic Crash Injuries",p:"Property Damage Crashes",d:"Traffic Deaths"}[n],i="State"==r?"NJ ".concat(o," per ").concat(c):"NJ ".concat(o," per {").concat(r,", ").concat(c,"}");return"dcm"==a&&(i+=" (12mo avgs)"),{id:a,name:"njdot/".concat(a),title:i,menuName:({i:"Injuries",p:"Property Damage",d:"Deaths"})[n],dropdownSection:s,style:"County"==r&&{height:580}}})))))),u={title:"NJ Traffic Deaths per Year",id:"per-year",name:"fatalities_per_year_by_type",menuName:"Traffic Deaths / Year",dropdownSection:"NJSP",filter:(0,r.m_)({mapRange:r.Oj})},d=[u,{id:"ytd",name:"ytd-deaths",title:"NJ Traffic Deaths per Year",menuName:"YTD",dropdownSection:"NJSP",filter:r._c,children:(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("p",{children:"Some data arrives weeks or months after the fact, so current year numbers are especially subject to change."})})},{id:"vs-homicides",name:"crash_homicide_cmp",title:"NJ Traffic Deaths vs. Homicides",menuName:"vs. Homicides",dropdownSection:"NJSP",children:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{children:"Traffic crashes kill 1.5-2x as many people as homicides in NJ."}),(0,a.jsxs)("p",{children:["Homicide data comes from ",(0,a.jsx)(c.Z,{href:"https://nj.gov/njsp/ucr/uniform-crime-reports.shtml",children:"NJ State Police"})," and ",(0,a.jsx)(c.Z,{href:"https://www.disastercenter.com/crime/njcrimn.htm",children:"Disaster Center"}),"."]})]})},{id:"per-month",name:"fatalities_per_month",title:"NJ Traffic Deaths per Month",menuName:"Per Month",dropdownSection:"NJSP"},{id:"by-month-bars",name:"fatalities_by_month_bars",title:"NJ Traffic Deaths, grouped by month",menuName:"Grouped by Month",dropdownSection:"NJSP"},...l]},34310:function(e,t,n){"use strict";n.d(t,{Tf:function(){return c},fQ:function(){return l},UY:function(){return i}});var a=n(13105);n(27842),n(32262);var r=n(17618);let c=a.Tf(r.Of,"svg"),s=a.tL("hudcostreets"),o=a.mr("hudcostreets"),i=[c,a._F("@neighborryan"),s,o],l="crash-data@hudcostreets.org"},41796:function(e,t,n){"use strict";n.d(t,{Iv:function(){return s},jy:function(){return c},mB:function(){return o}});var a=n(21358),r=n(62400);let c="https://nj.gov/njsp/info/fatalacc/",s="https://www.state.nj.us/transportation/refdata/accident/rawdata01-current.shtm";function o(){let e=r.env.S3_DBS?"https://nj-crashes.s3.amazonaws.com/njdot/data":"".concat((0,a.b)(),"/njdot");return{crashes:"".concat(e,"/crashes.db"),occupants:"".concat(e,"/occupants.db"),pedestrians:"".concat(e,"/pedestrians.db"),vehicles:"".concat(e,"/vehicles.db"),drivers:"".concat(e,"/drivers.db"),cmym:"".concat(e,"/cmym.db"),cmymc:"".concat(e,"/cmymc.db")}}},40873:function(e){e.exports={countySelect:"county-select_countySelect__rwRfM"}},71192:function(e){e.exports={footer:"footer_footer__gb1e2"}}}]);