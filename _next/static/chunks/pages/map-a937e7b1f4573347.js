(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[538],{5078:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/map",function(){return n(6232)}])},6232:function(e,t,n){"use strict";n.r(t),n.d(t,{__N_SSG:function(){return w},default:function(){return E}});var l=n(5893),r=n(5152),o=n.n(r),s=n(3290),a=n.n(s),i=n(7294),c=n(5083);n(4464);var u=n(2174),d=n(7046),h=n(7137),p=n(2001),m=n.n(p),x=n(4149),j=n.n(x);let{sqrt:g}=Math;function f(e){let{cluster:{key:t,lat:n,lon:r,tk:o,ti:s,tv:a,crashes:c},RL:{Circle:u,Popup:d},baseRadius:p,hoveredClusterKey:x,setHoveredClusterKey:f,selectedClusterKey:_,setSelectedClusterKey:v}=e,k=c.length,M=t===x||t===_,b=(0,i.useRef)(null),y=p*g(k),S="f"===c[0].severity?"red":"i"===c[0].severity?"orange":"yellow",w=(0,i.useMemo)(()=>{let e=(0,h.Z)(c.map(e=>{let{sri:t}=e;return t})),t=e&&(0,h.Z)(c.map(e=>{let{mp:t}=e;return t})),i=null;e&&(i=t?(0,l.jsxs)("span",{children:["SRI ",e,", MP ",t]}):(0,l.jsxs)("span",{children:["SRI ",e]}));let u=o>0;return M?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{children:[k," ",k>1?"crashes":"crash",": ",o?"".concat(o," killed, "):"",s," injured, ",a," vehicles"]}),(0,l.jsxs)("table",{className:j().clusterTable,children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{colSpan:4,children:"Date"}),u?(0,l.jsx)("th",{children:"Killed"}):null,s>0?(0,l.jsx)("th",{children:"Injured"}):null,(0,l.jsx)("th",{children:"Vehicles"}),e?null:(0,l.jsx)("th",{children:"SRI"}),t?null:(0,l.jsx)("th",{children:"MP"})]})}),(0,l.jsx)("tbody",{children:c.map((n,r)=>{let{dt:o,tk:s,ti:a,tv:i,sri:d,mp:h}=n,p=o.getFullYear(),x=o.getMonth(),j=o.getDate(),g=p.toString(),f=o.toLocaleString("en-US",{month:"short"}),_=j.toString(),{dt:v}=r>0?c[r-1]:{dt:null};return v&&(v.getFullYear()===p&&(g=""),v.getMonth()===x&&(f=""),v.getDate()===j&&(_="")),(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:g}),(0,l.jsx)("td",{children:f}),(0,l.jsx)("td",{children:_}),(0,l.jsx)("td",{children:m()("%H:%M",o)}),u?(0,l.jsx)("td",{children:s||""}):null,(0,l.jsx)("td",{children:a||""}),(0,l.jsx)("td",{children:i||""}),(0,l.jsx)("td",{children:e?null:d}),(0,l.jsx)("td",{children:t?null:h})]},r)})})]}),(0,l.jsxs)("details",{children:[(0,l.jsx)("summary",{children:"Location"}),(0,l.jsxs)("div",{children:[n,", ",r]}),(0,l.jsx)("div",{children:i})]})]}):null},[M,c,n,r,k,s,o,a]);return(0,i.useEffect)(()=>{var e,t;if(w)null===(t=b.current)||void 0===t||t.openPopup();else{null===(e=b.current)||void 0===e||e.closePopup();return}},[w]),(0,l.jsx)(u,{ref:b,center:[n,r],radius:y,color:S,eventHandlers:{mouseover:e=>{console.log("mouseover",e),f(t)},mouseout:e=>{console.log("mouseout",e)},click:e=>{console.log("click",e),v(t)}},children:(0,l.jsx)(d,{keepInView:!1,children:w})},t)}let{sqrt:_}=Math,{max:v,min:k,log2:M}=Math,b={openstreetmap:{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"&copy; <a href=&quot;http://osm.org/copyright&quot;>OpenStreetMap</a> contributors"},alidade_smooth_dark:{url:"https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png",attribution:'&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'}},y=o()(()=>Promise.all([n.e(269),n.e(225)]).then(n.bind(n,3225)),{loadableGenerated:{webpack:()=>[3225]},ssr:!1}),S={lat:40.725527,lng:-74.042037};var w=!0;function E(e){let{encodedCrashes:t}=e,n=(0,i.useMemo)(()=>{let e=function(e){let{rows:t,cols:n,dicts:l}=e;return t.map(e=>{let t={};return e.forEach((e,r)=>{let o=n[r];if(o in l){let n=l[o];if(n instanceof Array)t[o]=n[e];else{let{start:l,unit:r}=n;t[o]=new Date((l+e)*("s"===r?1e3:"m"===r?6e4:36e5))}}else t[o]=e}),t})}(t);return console.log(e.slice(0,100)),e},[t]),r={ll:(0,c.GS)({init:S,places:3}),z:(0,c.yc)(11,!1)},{ll:[{lat:o,lng:s},h],z:[p,m]}=(0,c.O5)({params:r});return(0,l.jsx)("div",{className:a().container,children:(0,l.jsx)(y,{className:a().map,center:{lat:o,lng:s},maxZoom:18,zoom:p,children:e=>(0,l.jsx)("div",{children:function(e,t){let{TileLayer:n,Marker:r,Circle:o,CircleMarker:s,Polyline:a,Pane:c,Popup:h,Tooltip:p,useMapEvents:m,useMap:x}=e,{crashes:j,setLL:g,setZoom:_}=t,{url:k,attribution:M}=b.alidade_smooth_dark,[y,S]=(0,i.useState)(),[w,E]=(0,i.useState)(),N=x(),P=N.getZoom(),z=(0,d.q)(N,P);console.log("MapBody render",P),m({movestart:()=>{},moveend:()=>g(N.getCenter()),zoom:()=>_(N.getZoom()),tooltipopen:e=>console.log("tooltipopen",e),mouseover:e=>console.log("mouseover",e),click:()=>{console.log("click"),S(void 0),E(void 0)},mousemove:e=>{}});let R=(0,i.useMemo)(()=>{let[e,t]=[12,18],[n,l]=[1,2],r=n+v(0,P-e)*(l-n)/(t-e);return console.log("baseRadius",r,"mPerPx",z,"zoom",P),r},[z,P]),O=(0,i.useMemo)(()=>{let e={};return j.forEach(t=>{let{lat:n,lon:l}=t,r="".concat(n,",").concat(l);r in e||(e[r]=[]),e[r].push(t)}),(0,u.qh)(e).map(e=>{let[t,n]=e,{lon:l,lat:r}=n[0],o=n.map(e=>{let{lon:t,lat:n,...l}=e;return l});o.sort((e,t)=>e.dt<t.dt?-1:e.dt>t.dt?1:0);let s=0,a=0,i=0,c=0,u=0;return o.forEach(e=>{let{tk:t,ti:n,tv:l,pk:r,pi:o}=e;t&&(s+=t),n&&(a+=n),l&&(i+=l),r&&(c+=r),o&&(u+=o)}),{key:t,lat:r,lon:l,tk:s,ti:a,tv:i,pk:c,pi:u,crashes:o}})},[j]),T={RL:{Circle:o,Popup:h},baseRadius:R,hoveredClusterKey:y,setHoveredClusterKey:S,selectedClusterKey:w,setSelectedClusterKey:E};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n,{url:k,attribution:M}),O.map(e=>(0,l.jsx)(f,{cluster:e,...T},e.key))]})}(e,{crashes:n,setLL:h,setZoom:m})})})})}},3290:function(e){e.exports={map:"map_map__hNvC1",container:"map_container__Xzg2E"}},4149:function(e){e.exports={clusterTable:"map_clusterTable__Fos_3"}}},function(e){e.O(0,[662,910,774,888,179],function(){return e(e.s=5078)}),_N_E=e.O()}]);