(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[458],{6470:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/njsp",function(){return n(1378)}])},1378:function(e,t,n){"use strict";n.r(t),n.d(t,{__N_SSG:function(){return u},default:function(){return h}});var a=n(1527);n(959);var r=n(5185),s=n.n(r),i=n(1949),o=n(8167),c=n(7149),l=n(3105),d=n(6038),u=!0;function h(e){return(0,a.jsxs)("div",{className:s().container,children:[(0,a.jsx)(i.F,{title:d.TN,description:"Analysis & Visualization of traffic crash data published by NJ State Police and NJ DOT",url:o.HQ,thumbnail:"".concat(o.HQ,"/plots/fatalities_per_year_by_type.png")}),(0,a.jsxs)("main",{className:s().main,children:[(0,a.jsx)("h1",{className:s().title,children:d.TN}),(0,a.jsxs)("p",{children:["Data comes from ",(0,a.jsx)(c.Z,{title:"NJ State Police fatal crash data",href:"https://nj.gov/njsp/info/fatalacc/",children:"NJ State Police"}),", and is updated daily (though crashes sometimes take weeks or months to show up)."]}),(0,a.jsxs)("div",{className:s()["plot-container"],children:[(0,a.jsx)(d.l_,{...e}),(0,a.jsx)("hr",{})]}),(0,a.jsxs)("p",{children:["Code and data are ",(0,a.jsx)(c.Z,{href:o.Tf.href,children:"on GitHub"}),"; feedback / issues ",(0,a.jsx)(c.Z,{href:"".concat(o.Tf.href,"/issues/new"),children:"here"}),")."]}),(0,a.jsx)(l.I_,{socials:[o.Tf,{name:"Hudson County Complete Streets",title:"Hudson County Complete Streets",href:"https://hudcostreets.org",src:"/logos/hccs.png"}]})]})]})}},6038:function(e,t,n){"use strict";n.d(t,{l_:function(){return h},TN:function(){return d}});var a=n(1527),r=n(8912).Buffer;async function s(e){let t,{db:n,tableData:a,stem:s}=e;if("csv"===a.kind){let e="".concat(s,".csv");t="'".concat(e,"'"),await n.registerFileText(e,a.data)}else{let e="".concat(s,".parquet");t="parquet_scan('".concat(e,"')");let i=new Uint8Array(r.from(a.base64,"base64"));await n.registerFileBuffer(e,i)}return t}var i=n(8068),o=n(4555),c=n(959);async function l(e){let{db:t,target:n,typeProjections:a,initialPlotData:r,types:s}=e,o=await (0,i.Vn)(t,"\n        SELECT\n            year,\n            CAST(sum(driver) as INT) as driver,\n            CAST(sum(pedestrian) as INT) as pedestrian,\n            CAST(sum(cyclist) as INT) as cyclist,\n            CAST(sum(passenger) as INT) as passenger,\n            CAST(sum(driver + pedestrian + cyclist + passenger) as INT) as total,\n            NULL as projected\n        FROM ".concat(n,"\n        GROUP BY year\n    ")),c=Array.from(s),l={Drivers:"driver",Pedestrians:"pedestrian",Cyclists:"cyclist",Passengers:"passenger",Projected:"projected"},d=c.map(e=>{let t=l[e];return t in a?a[t]:0}).reduce((e,t)=>e+t,0),u=o[o.length-1],h=c.map(e=>u[l[e]]).reduce((e,t)=>e+t,0);u.projected=d-h,console.log("got ytc data:",o);let p=1===s.size,m=r.map(e=>{let{name:t}=e,n=l[t],a={...e};return a.x=o.map(e=>e.year),a.y=o.map(e=>e[n]),a.visible=!!s.has(t)||"legendonly",p||(a.textposition="inside"),a}),f=p?[]:o.map(e=>{let{year:t,projected:n}=e,a=c.map(t=>e[l[t]]).reduce((e,t)=>e+t,0);return{x:t,y:a,text:"".concat(a),showarrow:!1,yshift:10}});return{rows:o,data:m,annotations:f}}let d="New Jersey Car Crash Deaths",u=["Drivers","Pedestrians","Cyclists","Passengers","Projected"];function h(e){let{params:t,tableData:n,typeProjections:r,rundate:h,yearTotalsMap:p}=e,m=o.xW,{src:f,name:y}=m;f=null!=f?f:"plots/".concat(y,".png");let[_,g]=(0,c.useState)(new Set(u)),[N,j]=(0,c.useState)(null),[x,S]=(0,c.useState)(null),{data:b,layout:w,...T}=t,[v,C]=(0,c.useState)(b),[D,P]=(0,c.useState)(w.annotations),[J,k]=(0,c.useState)(null),A=(0,c.useCallback)(e=>{if(_.has(e)){console.log("types: disable ".concat(e));let t=new Set(Array.from(_));t.delete(e),g(t)}else{console.log("types: enable ".concat(e));let t=new Set(Array.from(_));t.add(e),g(t)}return!1},[_]),H=(0,c.useCallback)(e=>(_.size<=1?(console.log("types: remove solo ".concat(e)),g(new Set(u))):(console.log("types: solo ".concat(e)),g(new Set([e]))),!1),[_]);return(0,c.useEffect)(()=>{(async function(){let e=await (0,i.Vx)();console.log("got db:",e),j(e);let t=await s({db:e,tableData:n,stem:"ytc"});console.log("registered target:",t),k(t)})()},[n]),(0,c.useEffect)(()=>{(async function(){if(!N||!J)return;let{rows:e,data:t,annotations:n}=await l({db:N,target:J,typeProjections:r,initialPlotData:b,types:_});S(e),C(t),P(n)})()},[N,J,r,b,_]),console.log("trace visibility:",v.map(e=>e.visible)),(0,a.jsx)(o.XN,{...m,params:{data:v,layout:{...w,annotations:D},...T},src:f,title:d,data:{rundate:h,yearTotalsMap:p},onLegendClick:A,onLegendDoubleClick:H})}},4555:function(e,t,n){"use strict";n.d(t,{Vv:function(){return y},XN:function(){return h},xW:function(){return f}});var a=n(1527);n(959);var r=n(424),s=n(7149),i=n(8167);let{HalfRoundWiden:o,filterIdxs:c,filterValues:l}=r,d=new Date().getFullYear(),u=d-1;function h(e){return r.XN(e)}let p=[],m=p.concat(...["y","m"].map(e=>p.concat(...["s","c"].map(t=>p.concat(...["d","i","p"].map(n=>{let a="".concat(n).concat(t).concat(e),r={s:"State",c:"County"}[t],s={y:"Year",m:"Month"}[e],i="".concat({s:"State",c:"Counties"}[t]," x ").concat(s,"s"),o={i:"Traffic Crash Injuries",p:"Property Damage Crashes",d:"Traffic Deaths"}[n],c="State"==r?"NJ ".concat(o," per ").concat(s):"NJ ".concat(o," per {").concat(r,", ").concat(s,"}");return"dcm"==a&&(c+=" (12mo avgs)"),{id:a,name:"njdot/".concat(a),title:c,menuName:({i:"Injuries",p:"Property Damage",d:"Deaths"})[n],dropdownSection:i,style:"County"==r&&{height:580}}})))))),f={title:"NJ Traffic Deaths per Year",id:"per-year",name:"fatalities_per_year_by_type",menuName:"Traffic Deaths / Year",dropdownSection:"NJSP",filter:l({mapRange:o}),children:e=>{let{rundate:t,yearTotalsMap:n}=e,r=n["2021"].total,o=n["2022"].total,c=n[u].total,{total:l,projected:h}=n[d],p=l+h,m=new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",timeZone:"UTC"});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{children:"Click/Double-click the legend to toggle/solo individual traces."}),(0,a.jsxs)("p",{children:["2021 and 2022 were the worst years in the NJSP record (since 2008), with ",r," and ",o," deaths, resp."]}),(0,a.jsxs)("p",{children:[(0,a.jsxs)(s.Z,{href:"".concat(i.Tf.href,"/commits/main"),children:["As of ",m]}),", ",d," has ",l," reported deaths, and ",(0,a.jsx)(s.Z,{href:"https://nbviewer.org/github/neighbor-ryan/nj-crashes/blob/main/njsp/update-projections.ipynb",children:"is estimated"})," to be on pace ",p>c?"to exceed ".concat(u,", with"):"for"," ",p," deaths."]})]})}},y=[f,{id:"ytd",name:"ytd-deaths",title:"NJ Traffic Deaths per Year",menuName:"YTD",dropdownSection:"NJSP",filter:c,children:(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("p",{children:"Some data arrives weeks or months after the fact, so current year numbers are especially subject to change."})})},{id:"vs-homicides",name:"crash_homicide_cmp",title:"NJ Traffic Deaths vs. Homicides",menuName:"vs. Homicides",dropdownSection:"NJSP",children:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{children:"Traffic crashes kill 1.5-2x as many people as homicides in NJ."}),(0,a.jsxs)("p",{children:["Homicide data comes from ",(0,a.jsx)(s.Z,{href:"https://nj.gov/njsp/ucr/uniform-crime-reports.shtml",children:"NJ State Police"})," and ",(0,a.jsx)(s.Z,{href:"https://www.disastercenter.com/crime/njcrimn.htm",children:"Disaster Center"}),"."]})]})},{id:"per-month",name:"fatalities_per_month",title:"NJ Traffic Deaths per Month",menuName:"Per Month",dropdownSection:"NJSP"},{id:"per-month-type",name:"fatalities_per_month_by_type",title:"NJ Traffic Deaths per Month (by Victim Type)",menuName:"By Victim Type",dropdownSection:"NJSP"},{id:"by-month-bars",name:"fatalities_by_month_bars",title:"NJ Traffic Deaths, grouped by month",menuName:"Grouped by Month",dropdownSection:"NJSP"},...m]},8167:function(e,t,n){"use strict";n.d(t,{Tf:function(){return s},UY:function(){return c},HQ:function(){return r}});var a=n(3105);n(7842),n(557);let r="https://neighbor-ryan.org/nj-crashes",s=a.Tf("neighbor-ryan/nj-crashes","svg"),i=a.tL("RunsAsCoded"),o=a.mr("neighbor_ryan"),c=[s,a._F("@neighborryan"),i,o]},5185:function(e){e.exports={container:"index_container__9GuY8",main:"index_main__c2BVR",title:"index_title__a_HQY","plot-container":"index_plot-container__NCtTQ",map:"index_map__G_wnO",bold:"index_bold__yXydk"}}},function(e){e.O(0,[149,68,62,774,888,179],function(){return e(e.s=6470)}),_N_E=e.O()}]);