(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[681],{1888:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return O}});var r=n(11527),u=n(50959),l=n(16117),o=n(69011),c=n(23999),i=n(63972),s=n(51641),a=n(3852);let f=(0,i.SO)(function(e,t){let n=new a.Popup(e,t.overlayContainer);return(0,s.O)(n,t)},function(e,t,{position:n},r){(0,u.useEffect)(function(){let{instance:u}=e;function l(e){e.popup===u&&(u.update(),r(!0))}function o(e){e.popup===u&&r(!1)}return t.map.on({popupopen:l,popupclose:o}),null==t.overlayContainer?(null!=n&&u.setLatLng(n),u.openOn(t.map)):t.overlayContainer.bindPopup(u),function(){t.map.off({popupopen:l,popupclose:o}),t.overlayContainer?.unbindPopup(),t.map.removeLayer(u)}},[e,t,r,n])});var d=n(82875),p=n.n(d),h=n(73115),m=n.n(h);let{sqrt:v}=Math;function j(e){let{cluster:{key:t,lat:n,lon:l,tk:i,ti:s,tv:a,crashes:d},baseRadius:h,hoveredClusterKey:j,setHoveredClusterKey:x,selectedClusterKey:y,setSelectedClusterKey:g}=e,b=d.length,E=t===j||t===y,O=(0,u.useRef)(null),_=h*v(b),C="f"===d[0].severity?"red":"i"===d[0].severity?"orange":"yellow",S=(0,u.useMemo)(()=>{if(!E)return null;let e=(0,o.Z)(d.map(e=>{let{sri:t}=e;return t})),t=e&&(0,o.Z)(d.map(e=>{let{mp:t}=e;return t})),u=null;e&&(u=null!==t?(0,r.jsxs)("span",{children:["SRI ",e,", MP ",t]}):(0,r.jsxs)("span",{children:["SRI ",e]}));let c=i>0,f=s>0,h=[];i&&h.push("".concat(i," killed")),s&&h.push("".concat(s," injured")),a&&h.push("".concat(a," vehicles"));let v=h.length?": ".concat(h.join(", ")):"";return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[b," ",b>1?"crashes":"crash",v]}),(0,r.jsxs)("table",{className:m().clusterTable,children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{colSpan:3,children:"Date"}),(0,r.jsx)("th",{children:"Time"}),c?(0,r.jsx)("th",{children:"Killed"}):null,f?(0,r.jsx)("th",{children:"Injured"}):null,(0,r.jsx)("th",{children:"Vehicles"}),e?null:(0,r.jsx)("th",{children:"SRI"}),null!==t?null:(0,r.jsx)("th",{children:"MP"})]})}),(0,r.jsx)("tbody",{children:d.map((n,u)=>{let{dt:l,tk:o,ti:i,tv:s,sri:a,mp:f}=n,h=l.getFullYear(),m=l.getMonth(),v=l.getDate(),j=h.toString(),x=l.toLocaleString("en-US",{month:"short"}),y=v.toString(),{dt:g}=u>0?d[u-1]:{dt:null};g&&(g.getFullYear()===h&&(j=""),g.getMonth()===m&&(x=""),g.getDate()===v&&(y=""));let b="☠️".repeat(o),E="\uD83C\uDFE5".repeat(i),O="\uD83D\uDE97".repeat(s);return(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:j}),(0,r.jsx)("td",{children:x}),(0,r.jsx)("td",{children:y}),(0,r.jsx)("td",{children:p()("%H:%M",l)}),c?(0,r.jsx)("td",{children:o?b:""}):null,(0,r.jsx)("td",{children:i?E:""}),(0,r.jsx)("td",{children:s?O:""}),e?null:(0,r.jsx)("td",{children:a}),null!==t?null:(0,r.jsx)("td",{children:f})]},u)})})]}),(0,r.jsxs)("details",{children:[(0,r.jsx)("summary",{children:"Location"}),(0,r.jsxs)("div",{className:m().llDetails,children:[n,", ",l]}),(0,r.jsx)("div",{children:u})]})]})},[E,d,n,l,b,s,i,a]);(0,u.useEffect)(()=>{var e,t;if(S)null===(t=O.current)||void 0===t||t.openPopup();else{null===(e=O.current)||void 0===e||e.closePopup();return}},[S]);let k=(0,u.useMemo)(()=>({mouseover:e=>{console.log("mouseover",e),x(t)},mouseout:e=>{console.log("mouseout",e)},click:e=>{console.log("click",e),g(t)}}),[t,x,g]);return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(c.C,{center:[n,l],radius:_,color:C,ref:O,key:t,eventHandlers:k,children:(0,r.jsx)(f,{keepInView:!1,children:S})})})}var x=n(23007);let{max:y}=Math;function g(e){let{crashes:t}=e,[n,o]=(0,u.useState)(),[c,i]=(0,u.useState)(),s=(0,l.Sx)().getZoom();(0,l.zV)({movestart:()=>{},click:()=>{console.log("click"),o(void 0),i(void 0)},mousemove:e=>{}});let a=(0,u.useMemo)(()=>{let[e,t]=[12,18],[n,r]=[1,2],u=n+y(0,s-e)*(r-n)/(t-e);return console.log("baseRadius",u,"zoom",s),u},[s]),f=(0,u.useMemo)(()=>{let e={};return t.forEach(t=>{let{lat:n,lon:r}=t,u="".concat(n,",").concat(r);u in e||(e[u]=[]),e[u].push(t)}),(0,x._I)(e,(e,t)=>{let{lon:n,lat:r}=t[0],u=t.map(e=>{let{lon:t,lat:n,...r}=e;return r});u.sort((e,t)=>e.dt<t.dt?-1:e.dt>t.dt?1:0);let l=0,o=0,c=0,i=0,s=0;return u.forEach(e=>{let{tk:t,ti:n,tv:r,pk:u,pi:a}=e;t&&(l+=t),n&&(o+=n),r&&(c+=r),u&&(i+=u),a&&(s+=a)}),{key:e,lat:r,lon:n,tk:l,ti:o,tv:c,pk:i,pi:s,crashes:u}})},[t]);return(0,u.useMemo)(()=>{console.log("clustersElem");let e={baseRadius:a,hoveredClusterKey:n,setHoveredClusterKey:o,selectedClusterKey:c,setSelectedClusterKey:i};return(0,r.jsx)(r.Fragment,{children:f.map(t=>(0,r.jsx)(j,{cluster:t,...e},t.key))})},[f,a,n,o,c,i])}var b=n(68089),E=n(14421);function O(e){let{crashes:t,hudco:n,...u}=e;return(0,r.jsxs)(b.Z,{...u,children:[(0,r.jsx)(E.Q,{data:n,style:{fillColor:"yellow",color:"yellow",opacity:.5,fillOpacity:0}}),(0,r.jsx)(g,{crashes:t})]})}},73115:function(e){e.exports={clusterTable:"cluster_clusterTable__S_jCx",clusterIcon:"cluster_clusterIcon__K1tJm",cluster:"cluster_cluster__1d7nf",llDetails:"cluster_llDetails__JzNXp"}},23007:function(e,t,n){"use strict";function r(e,t){return o(e).map(([e,n],r)=>t(e,n,r))}function u(e){return Object.keys(e)}function l(e){return Object.values(e)}function o(e){return Object.entries(e)}function c(e){return Object.fromEntries(e)}function i(e,t){return c(o(e).map(([e,n],r)=>t(e,n,r)))}function s(e,t){return i(e,(e,n)=>[e,t(e,n)])}n.d(t,{Q8:function(){return s},V7:function(){return i},VO:function(){return l},XP:function(){return u},_I:function(){return r},sq:function(){return c}})},68089:function(e,t,n){"use strict";n.d(t,{Z:function(){return x}});var r=n(50959),u=n(75448),l=n(3852);function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}let c=(0,r.forwardRef)(function({bounds:e,boundsOptions:t,center:n,children:c,className:i,id:s,placeholder:a,style:f,whenReady:d,zoom:p,...h},m){let[v]=(0,r.useState)({className:i,id:s,style:f}),[j,x]=(0,r.useState)(null);(0,r.useImperativeHandle)(m,()=>j?.map??null,[j]);let y=(0,r.useCallback)(r=>{if(null!==r&&null===j){let o=new l.Map(r,h);null!=n&&null!=p?o.setView(n,p):null!=e&&o.fitBounds(e,t),null!=d&&o.whenReady(d),x((0,u.Hb)(o))}},[]);(0,r.useEffect)(()=>()=>{j?.map.remove()},[j]);let g=j?r.createElement(u.UO,{value:j},c):a??null;return r.createElement("div",o({},v,{ref:y}),g)});var i=n(16117);function s({setCenter:e,setZoom:t,onClick:n,children:u}){let l=(0,i.Sx)();return(0,i.zV)({click:e=>{console.log("leaflet click:",e),n&&n(e)},moveend:()=>e(l.getCenter()),zoom:()=>t(l.getZoom())}),r.createElement(r.Fragment,null,u)}var a=n(63972),f=n(81867),d=n(51641);function p(e,t,n){let{opacity:r,zIndex:u}=t;null!=r&&r!==n.opacity&&e.setOpacity(r),null!=u&&u!==n.zIndex&&e.setZIndex(u)}let h=(0,a.Lf)(function({url:e,...t},n){let r=new l.TileLayer(e,(0,f.q)(t,n));return(0,d.O)(r,n)},function(e,t,n){p(e,t,n);let{url:r}=t;null!=r&&r!==n.url&&e.setUrl(r)}),m={openstreetmap:{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"&copy; <a href=&quot;http://osm.org/copyright&quot;>OpenStreetMap</a> contributors"},alidade_smooth_dark:{url:"https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png",attribution:'&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'}},v=(0,a.Lf)(function({url:e,...t},n){let r=new l.TileLayer(e,(0,f.q)(t,n));return(0,d.O)(r,n)},function(e,t,n){p(e,t,n);let{url:r}=t;null!=r&&r!==n.url&&e.setUrl(r)});function j({map:e="alidade_smooth_dark",edgeBufferTiles:t,...n}){let{url:u,attribution:l}=m[e];return t?r.createElement(v,{url:u,attribution:l,...n}):r.createElement(h,{url:u,attribution:l,...n})}function x({map:e="alidade_smooth_dark",edgeBufferTiles:t,setCenter:n,setZoom:u,tolerance:o=12,padding:i=.5,onClick:a,children:f,...d}){let p=(0,r.useMemo)(()=>l.canvas({tolerance:o,padding:i}),[o,i]);return r.createElement(c,{...d,renderer:p},r.createElement(s,{setCenter:n,setZoom:u,onClick:a},r.createElement(j,{map:e,edgeBufferTiles:t}),f))}},75448:function(e,t,n){"use strict";n.d(t,{Hb:function(){return u},UO:function(){return c},mE:function(){return i},sj:function(){return l}});var r=n(50959);function u(e){return Object.freeze({__version:1,map:e})}function l(e,t){return Object.freeze({...e,...t})}let o=(0,r.createContext)(null),c=o.Provider;function i(){let e=(0,r.useContext)(o);if(null==e)throw Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}},51641:function(e,t,n){"use strict";n.d(t,{I:function(){return l},O:function(){return u}});var r=n(50959);function u(e,t,n){return Object.freeze({instance:e,context:t,container:n})}function l(e,t){return null==t?function(t,n){let u=(0,r.useRef)();return u.current||(u.current=e(t,n)),u}:function(n,u){let l=(0,r.useRef)();l.current||(l.current=e(n,u));let o=(0,r.useRef)(n),{instance:c}=l.current;return(0,r.useEffect)(function(){o.current!==n&&(t(c,n,o.current),o.current=n)},[c,n,u]),l}}},63972:function(e,t,n){"use strict";n.d(t,{SO:function(){return f},Au:function(){return d},Lf:function(){return p}});var r=n(50959),u=n(10422),l=n(75448),o=n(51641);function c(e,t){let n=(0,r.useRef)(t);(0,r.useEffect)(function(){t!==n.current&&null!=e.attributionControl&&(null!=n.current&&e.attributionControl.removeAttribution(n.current),null!=t&&e.attributionControl.addAttribution(t)),n.current=t},[e,t])}function i(e,t){let n=(0,r.useRef)();(0,r.useEffect)(function(){return null!=t&&e.instance.on(t),n.current=t,function(){null!=n.current&&e.instance.off(n.current),n.current=null}},[e,t])}var s=n(81867);function a(e,t){(0,r.useEffect)(function(){return(t.layerContainer??t.map).addLayer(e.instance),function(){t.layerContainer?.removeLayer(e.instance),t.map.removeLayer(e.instance)}},[t,e])}function f(e,t){var n,a;return n=(0,o.I)(e),a=function(e,r){let u=(0,l.mE)(),o=n((0,s.q)(e,u),u);return c(u.map,e.attribution),i(o.current,e.eventHandlers),t(o.current,u,e,r),o},(0,r.forwardRef)(function(e,t){let[n,l]=(0,r.useState)(!1),{instance:o}=a(e,l).current;(0,r.useImperativeHandle)(t,()=>o),(0,r.useEffect)(function(){n&&o.update()},[o,n,e.children]);let c=o._contentNode;return c?(0,u.createPortal)(e.children,c):null})}function d(e,t){var n,u;return n=(0,o.I)(e,t),u=function(e){let t=(0,l.mE)(),u=n((0,s.q)(e,t),t);return i(u.current,e.eventHandlers),a(u.current,t),function(e,t){let n=(0,r.useRef)();(0,r.useEffect)(function(){if(t.pathOptions!==n.current){let r=t.pathOptions??{};e.instance.setStyle(r),n.current=r}},[e,t])}(u.current,e),u},(0,r.forwardRef)(function(e,t){let{instance:n,context:o}=u(e).current;return(0,r.useImperativeHandle)(t,()=>n),null==e.children?null:r.createElement(l.UO,{value:o},e.children)})}function p(e,t){var n,u;return n=(0,o.I)(e,t),u=function(e){let t=(0,l.mE)(),r=n((0,s.q)(e,t),t);return c(t.map,e.attribution),i(r.current,e.eventHandlers),a(r.current,t),r},(0,r.forwardRef)(function(e,t){let{instance:n}=u(e).current;return(0,r.useImperativeHandle)(t,()=>n),null})}},81867:function(e,t,n){"use strict";function r(e,t){let n=e.pane??t.pane;return n?{...e,pane:n}:e}n.d(t,{q:function(){return r}})},23999:function(e,t,n){"use strict";n.d(t,{C:function(){return c}});var r=n(63972),u=n(51641),l=n(75448),o=n(3852);let c=(0,r.Au)(function({center:e,children:t,...n},r){let c=new o.Circle(e,n);return(0,u.O)(c,(0,l.sj)(r,{overlayContainer:c}))},function(e,t,n){t.center!==n.center&&e.setLatLng(t.center),null!=t.radius&&t.radius!==n.radius&&e.setRadius(t.radius)})},14421:function(e,t,n){"use strict";n.d(t,{Q:function(){return c}});var r=n(63972),u=n(51641),l=n(75448),o=n(3852);let c=(0,r.Au)(function({data:e,...t},n){let r=new o.GeoJSON(e,t);return(0,u.O)(r,(0,l.sj)(n,{overlayContainer:r}))},function(e,t,n){t.style!==n.style&&(null==t.style?e.resetStyle():e.setStyle(t.style))})},16117:function(e,t,n){"use strict";n.d(t,{Sx:function(){return l},zV:function(){return o}});var r=n(75448),u=n(50959);function l(){return(0,r.mE)().map}function o(e){let t=l();return(0,u.useEffect)(function(){return t.on(e),function(){t.off(e)}},[t,e]),t}}}]);