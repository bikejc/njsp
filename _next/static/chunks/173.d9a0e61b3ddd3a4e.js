(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[173],{2173:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return _}});var r=t(1527),s=t(959),n=t(6117),c=t(8725),u=t(3999),o=t(7021),i=t(2875),d=t.n(i),a=t(3115),h=t.n(a);let{sqrt:j}=Math;function x(e){let{cluster:{key:l,lat:t,lon:n,tk:i,ti:a,tv:x,crashes:m},baseRadius:p,hoveredClusterKey:g,setHoveredClusterKey:f,selectedClusterKey:v,setSelectedClusterKey:_}=e,k=m.length,M=l===g||l===v,S=(0,s.useRef)(null),y=p*j(k),D="f"===m[0].severity?"red":"i"===m[0].severity?"orange":"yellow",b=(0,s.useMemo)(()=>{if(!M)return null;let e=(0,c.Z)(m.map(e=>{let{sri:l}=e;return l})),l=e&&(0,c.Z)(m.map(e=>{let{mp:l}=e;return l})),s=null;e&&(s=null!==l?(0,r.jsxs)("span",{children:["SRI ",e,", MP ",l]}):(0,r.jsxs)("span",{children:["SRI ",e]}));let u=i>0,o=a>0,j=[];i&&j.push("".concat(i," killed")),a&&j.push("".concat(a," injured")),x&&j.push("".concat(x," vehicles"));let p=j.length?": ".concat(j.join(", ")):"";return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[k," ",k>1?"crashes":"crash",p]}),(0,r.jsxs)("table",{className:h().clusterTable,children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{colSpan:3,children:"Date"}),(0,r.jsx)("th",{children:"Time"}),u?(0,r.jsx)("th",{children:"Killed"}):null,o?(0,r.jsx)("th",{children:"Injured"}):null,(0,r.jsx)("th",{children:"Vehicles"}),e?null:(0,r.jsx)("th",{children:"SRI"}),null!==l?null:(0,r.jsx)("th",{children:"MP"})]})}),(0,r.jsx)("tbody",{children:m.map((t,s)=>{let{dt:n,tk:c,ti:o,tv:i,sri:a,mp:h}=t,j=n.getFullYear(),x=n.getMonth(),p=n.getDate(),g=j.toString(),f=n.toLocaleString("en-US",{month:"short"}),v=p.toString(),{dt:_}=s>0?m[s-1]:{dt:null};_&&(_.getFullYear()===j&&(g=""),_.getMonth()===x&&(f=""),_.getDate()===p&&(v=""));let k="☠️".repeat(c),M="\uD83C\uDFE5".repeat(o),S="\uD83D\uDE97".repeat(i);return(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:g}),(0,r.jsx)("td",{children:f}),(0,r.jsx)("td",{children:v}),(0,r.jsx)("td",{children:d()("%H:%M",n)}),u?(0,r.jsx)("td",{children:c?k:""}):null,(0,r.jsx)("td",{children:o?M:""}),(0,r.jsx)("td",{children:i?S:""}),e?null:(0,r.jsx)("td",{children:a}),null!==l?null:(0,r.jsx)("td",{children:h})]},s)})})]}),(0,r.jsxs)("details",{children:[(0,r.jsx)("summary",{children:"Location"}),(0,r.jsxs)("div",{className:h().llDetails,children:[t,", ",n]}),(0,r.jsx)("div",{children:s})]})]})},[M,m,t,n,k,a,i,x]);(0,s.useEffect)(()=>{var e,l;if(b)null===(l=S.current)||void 0===l||l.openPopup();else{null===(e=S.current)||void 0===e||e.closePopup();return}},[b]);let E=(0,s.useMemo)(()=>({mouseover:e=>{console.log("mouseover",e),f(l)},mouseout:e=>{console.log("mouseout",e)},click:e=>{console.log("click",e),_(l)}}),[l,f,_]);return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(u.C,{center:[t,n],radius:y,color:D,ref:S,key:l,eventHandlers:E,children:(0,r.jsx)(o.G,{keepInView:!1,children:b})})})}var m=t(7253);let{max:p}=Math;function g(e){let{crashes:l}=e,[t,c]=(0,s.useState)(),[u,o]=(0,s.useState)(),i=(0,n.Sx)().getZoom();(0,n.zV)({movestart:()=>{},click:()=>{console.log("click"),c(void 0),o(void 0)},mousemove:e=>{}});let d=(0,s.useMemo)(()=>{let[e,l]=[12,18],[t,r]=[1,2],s=t+p(0,i-e)*(r-t)/(l-e);return console.log("baseRadius",s,"zoom",i),s},[i]),a=(0,s.useMemo)(()=>{let e={};return l.forEach(l=>{let{lat:t,lon:r}=l,s="".concat(t,",").concat(r);s in e||(e[s]=[]),e[s].push(l)}),(0,m.qh)(e).map(e=>{let[l,t]=e,{lon:r,lat:s}=t[0],n=t.map(e=>{let{lon:l,lat:t,...r}=e;return r});n.sort((e,l)=>e.dt<l.dt?-1:e.dt>l.dt?1:0);let c=0,u=0,o=0,i=0,d=0;return n.forEach(e=>{let{tk:l,ti:t,tv:r,pk:s,pi:n}=e;l&&(c+=l),t&&(u+=t),r&&(o+=r),s&&(i+=s),n&&(d+=n)}),{key:l,lat:s,lon:r,tk:c,ti:u,tv:o,pk:i,pi:d,crashes:n}})},[l]);return(0,s.useMemo)(()=>{console.log("clustersElem");let e={baseRadius:d,hoveredClusterKey:t,setHoveredClusterKey:c,selectedClusterKey:u,setSelectedClusterKey:o};return(0,r.jsx)(r.Fragment,{children:a.map(l=>(0,r.jsx)(x,{cluster:l,...e},l.key))})},[a,d,t,c,u,o])}var f=t(8089),v=t(4421);function _(e){let{crashes:l,hudco:t,...s}=e;return(0,r.jsxs)(f.Z,{...s,children:[(0,r.jsx)(v.Q,{data:t,style:{fillColor:"yellow",color:"yellow",opacity:.5,fillOpacity:0}}),(0,r.jsx)(g,{crashes:l})]})}},3115:function(e){e.exports={clusterTable:"cluster_clusterTable__S_jCx",clusterIcon:"cluster_clusterIcon__K1tJm",cluster:"cluster_cluster__1d7nf",llDetails:"cluster_llDetails__JzNXp"}}}]);